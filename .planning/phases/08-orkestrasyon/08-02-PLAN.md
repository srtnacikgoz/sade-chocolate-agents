---
phase: 08-orkestrasyon
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/sade_agents/crews/product_launch_crew.py
  - src/sade_agents/crews/market_analysis_crew.py
  - src/sade_agents/crews/quality_audit_crew.py
  - src/sade_agents/crews/factory.py
  - src/sade_agents/crews/__init__.py
autonomous: true

must_haves:
  truths:
    - "ProductLaunchCrew orchestrates Alchemist -> Narrator -> Curator -> Perfectionist"
    - "MarketAnalysisCrew orchestrates PricingAnalyst -> GrowthHacker -> Narrator"
    - "QualityAuditCrew can audit any content using Perfectionist"
    - "SadeCrewFactory creates all three crew types"
  artifacts:
    - path: "src/sade_agents/crews/product_launch_crew.py"
      provides: "ProductLaunchCrew class"
      contains: "class ProductLaunchCrew"
    - path: "src/sade_agents/crews/market_analysis_crew.py"
      provides: "MarketAnalysisCrew class"
      contains: "class MarketAnalysisCrew"
    - path: "src/sade_agents/crews/quality_audit_crew.py"
      provides: "QualityAuditCrew class"
      contains: "class QualityAuditCrew"
    - path: "src/sade_agents/crews/factory.py"
      provides: "SadeCrewFactory"
      contains: "class SadeCrewFactory"
  key_links:
    - from: "src/sade_agents/crews/product_launch_crew.py"
      to: "AlchemistAgent, NarratorAgent, CuratorAgent, PerfectionistAgent"
      via: "agent imports and task creation"
      pattern: "from sade_agents.agents import"
    - from: "src/sade_agents/crews/factory.py"
      to: "ProductLaunchCrew, MarketAnalysisCrew, QualityAuditCrew"
      via: "crew instantiation"
      pattern: "create_.*_crew"
---

<objective>
Implement three specialized Crew compositions and a factory to create them.

Purpose: Enable multi-agent workflows for Product Launch, Market Analysis, and Quality Audit scenarios.
Output: 3 crew classes + SadeCrewFactory, all using CrewAI Sequential Process with task context
</objective>

<execution_context>
@C:\Users\Hp\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Hp\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-orkestrasyon/08-RESEARCH.md
@.planning/phases/08-orkestrasyon/08-01-SUMMARY.md

@src/sade_agents/agents/__init__.py
@src/sade_agents/models/workflow_models.py
@src/sade_agents/crews/base_crew.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement ProductLaunchCrew</name>
  <files>src/sade_agents/crews/product_launch_crew.py</files>
  <action>
Create `src/sade_agents/crews/product_launch_crew.py`:

```python
"""
Sade Chocolate - Product Launch Crew.

Yeni urun gelistirme workflow'u:
Alchemist (recete) -> Narrator (hikaye) -> Curator (etiket) -> Perfectionist (denetim)
"""

import time
from crewai import Crew, Process

from sade_agents.agents import (
    AlchemistAgent,
    NarratorAgent,
    CuratorAgent,
    PerfectionistAgent,
)
from sade_agents.crews.base_crew import create_task_with_context
from sade_agents.models import ProductLaunchInput, ProductLaunchOutput


class ProductLaunchCrew:
    """
    Urun lansmanÄ± workflow'u.

    Pipeline: Alchemist -> Narrator -> Curator -> Perfectionist
    Kullanim: Yeni lezzet gelistirme, receteden onaylanmis etikete

    Agents:
    - Alchemist: Recete ve lezzet profili olusturur
    - Narrator: Urun hikayesi, caption, kutu notu yazar
    - Curator: Etiket gorseli tasarlar
    - Perfectionist: Tum ciktilari marka tutarliligi icin denetler
    """

    def __init__(self) -> None:
        """Agent'lari olusturur."""
        self.alchemist = AlchemistAgent()
        self.narrator = NarratorAgent()
        self.curator = CuratorAgent()
        self.perfectionist = PerfectionistAgent()

    def _create_tasks(self, inputs: ProductLaunchInput) -> list:
        """Task zinciri olusturur, context bagimliliklari ile."""
        # Task 1: Alchemist - Recete olustur
        recipe_task = create_task_with_context(
            description=f"""
Yeni cikolata recetesi olustur: {inputs.flavor_concept}

Hedef kitle: {inputs.target_audience}
Fiyat araligi: {inputs.price_range[0]}-{inputs.price_range[1]} TL

Cikti formati:
- Lezzet profili (tatli/mayhos/aci dengesi)
- Ana malzemeler listesi
- Ozel teknik notlar (temperleme, kakao orani vs.)
- Tavsiye gramaj ve sunumu
            """,
            expected_output="JSON formatinda recete: flavor_profile, ingredients, technical_notes, serving_suggestion",
            agent=self.alchemist,
        )

        # Task 2: Narrator - Hikaye yaz (receteye bagli)
        story_task = create_task_with_context(
            description=f"""
Olusturulan recete icin 'Sessiz Luks' tonunda icerikler yaz:

1. Etiket Hikayesi - urun arkasina (2-3 cumle)
2. Instagram Caption - sosyal medya postu
3. Kutu Ici Not - hediye karti

Kurallar:
- Emoji YASAK
- "Hemen Al", "Kacirma" gibi ifadeler YASAK
- Sofistike, understated ton
- Monocle/Kinfolk editoru gibi
            """,
            expected_output="JSON: etiket_hikayesi, instagram_caption, kutu_notu",
            agent=self.narrator,
            context=[recipe_task],
        )

        # Task 3: Curator - Etiket tasarla (recete + hikayeye bagli)
        label_task = create_task_with_context(
            description=f"""
Recete ve hikaye bilgilerini kullanarak etiket gorseli tasarla.

Urun: {inputs.flavor_concept}

Stil kurallari:
- Quiet Luxury estetigi
- Cormorant Garamond + Outfit tipografi
- Dark Chocolate/Cream Beige/Muted Gold renk paleti
- 3:4 aspect ratio, 2K res
- Maksimum 25 karakter urun adi
            """,
            expected_output="Olusturulan etiket dosya yolu (PNG)",
            agent=self.curator,
            context=[recipe_task, story_task],
        )

        tasks = [recipe_task, story_task, label_task]

        # Task 4 (optional): Perfectionist - Denetim
        if inputs.include_audit:
            audit_task = create_task_with_context(
                description="""
Olusturulan tum ciktilari marka tutarliligi icin denetle:

1. Hikaye metinlerini kontrol et (ton, yasak kelimeler)
2. Etiket uyumunu degerlendir (renk, tipografi)

Her cikti icin AuditResult formati kullan.
                """,
                expected_output="AuditResult JSON: overall_score, verdict, issues, suggestions",
                agent=self.perfectionist,
                context=[story_task, label_task],
            )
            tasks.append(audit_task)

        return tasks

    def kickoff(self, inputs: dict) -> ProductLaunchOutput:
        """
        Product launch workflow'unu calistirir.

        Args:
            inputs: ProductLaunchInput field'lari

        Returns:
            ProductLaunchOutput with recipe, story, label_paths, audit
        """
        validated_inputs = ProductLaunchInput(**inputs)
        tasks = self._create_tasks(validated_inputs)

        agents = [self.alchemist, self.narrator, self.curator]
        if validated_inputs.include_audit:
            agents.append(self.perfectionist)

        crew = Crew(
            agents=agents,
            tasks=tasks,
            process=Process.sequential,
            verbose=True,
        )

        start_time = time.time()
        result = crew.kickoff(inputs=inputs)
        elapsed = time.time() - start_time

        # Parse result into structured output
        # Note: In production, parse actual CrewAI output
        return ProductLaunchOutput(
            recipe={"raw_output": str(result)},
            story={"raw_output": str(result)},
            label_paths=[],  # Populated by Curator
            audit=None,  # Populated by Perfectionist if include_audit
            execution_time_seconds=elapsed,
        )


__all__ = ["ProductLaunchCrew"]
```
  </action>
  <verify>
    python -c "from sade_agents.crews.product_launch_crew import ProductLaunchCrew; crew = ProductLaunchCrew(); print(f'ProductLaunchCrew created with {len([crew.alchemist, crew.narrator, crew.curator, crew.perfectionist])} agents')"
  </verify>
  <done>
    ProductLaunchCrew class exists, can instantiate agents, has kickoff method
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement MarketAnalysisCrew and QualityAuditCrew</name>
  <files>
    src/sade_agents/crews/market_analysis_crew.py
    src/sade_agents/crews/quality_audit_crew.py
  </files>
  <action>
Create `src/sade_agents/crews/market_analysis_crew.py`:

```python
"""
Sade Chocolate - Market Analysis Crew.

Pazar analizi workflow'u:
PricingAnalyst (rakip fiyat) -> GrowthHacker (trendler) -> Narrator (ozet)
"""

import time
from crewai import Crew, Process

from sade_agents.agents import (
    PricingAnalystAgent,
    GrowthHackerAgent,
    NarratorAgent,
)
from sade_agents.crews.base_crew import create_task_with_context
from sade_agents.models import MarketAnalysisInput, MarketAnalysisOutput


class MarketAnalysisCrew:
    """
    Pazar analizi workflow'u.

    Pipeline: PricingAnalyst -> GrowthHacker -> Narrator
    Kullanim: Rakip istihbarati ve pazar firsatlari raporu

    Agents:
    - PricingAnalyst: Rakip fiyat analizi yapar
    - GrowthHacker: Trend ve buyume firsatlari belirler
    - Narrator: Bulgulari marka sesinde ozetler
    """

    def __init__(self) -> None:
        """Agent'lari olusturur."""
        self.pricing = PricingAnalystAgent()
        self.growth = GrowthHackerAgent()
        self.narrator = NarratorAgent()

    def _create_tasks(self, inputs: MarketAnalysisInput) -> list:
        """Task zinciri olusturur."""
        # Task 1: PricingAnalyst - Fiyat analizi
        pricing_task = create_task_with_context(
            description=f"""
Rakip fiyat analizi yap: {inputs.competitor_name}

Kategori: {inputs.product_category}

Analiz et:
- Rakibin fiyat araligi
- Gramaj basina fiyat karsilastirmasi
- Fiyat konumlandirma onerileri
            """,
            expected_output="JSON: competitor_prices, price_per_gram, recommendations",
            agent=self.pricing,
        )

        tasks = [pricing_task]

        # Task 2 (optional): GrowthHacker - Trend raporu
        if inputs.include_trends:
            trend_task = create_task_with_context(
                description=f"""
{inputs.product_category} kategorisinde trend analizi yap.

Fiyat analizini de goz onunde bulundur.

Raporla:
- Guncel pazar trendleri
- Buyume firsatlari
- Onerilen aksiyonlar
                """,
                expected_output="JSON: trends, opportunities, recommended_actions",
                agent=self.growth,
                context=[pricing_task],
            )
            tasks.append(trend_task)

        # Task 3: Narrator - Marka sesinde ozet
        summary_context = tasks.copy()
        summary_task = create_task_with_context(
            description="""
Tum analiz bulgularini 'Sessiz Luks' tonunda ozetle.

Yonetim icin kisa brief hazirla:
- Temel bulgular (2-3 madde)
- Stratejik oneriler (1-2 madde)
- Aksiyon onerileri

Ton: Sofistike, oz, karar vericiye yonelik
            """,
            expected_output="Turkce ozet paragraf (max 150 kelime)",
            agent=self.narrator,
            context=summary_context,
        )
        tasks.append(summary_task)

        return tasks

    def kickoff(self, inputs: dict) -> MarketAnalysisOutput:
        """
        Market analysis workflow'unu calistirir.

        Args:
            inputs: MarketAnalysisInput field'lari

        Returns:
            MarketAnalysisOutput
        """
        validated_inputs = MarketAnalysisInput(**inputs)
        tasks = self._create_tasks(validated_inputs)

        agents = [self.pricing, self.narrator]
        if validated_inputs.include_trends:
            agents.insert(1, self.growth)

        crew = Crew(
            agents=agents,
            tasks=tasks,
            process=Process.sequential,
            verbose=True,
        )

        start_time = time.time()
        result = crew.kickoff(inputs=inputs)
        elapsed = time.time() - start_time

        return MarketAnalysisOutput(
            pricing_analysis={"raw_output": str(result)},
            trend_report={"raw_output": str(result)} if validated_inputs.include_trends else None,
            summary=str(result),
            execution_time_seconds=elapsed,
        )


__all__ = ["MarketAnalysisCrew"]
```

Create `src/sade_agents/crews/quality_audit_crew.py`:

```python
"""
Sade Chocolate - Quality Audit Crew.

Kalite denetimi workflow'u:
Herhangi bir icerigi Perfectionist ile denetler.
"""

import time
from crewai import Crew, Process

from sade_agents.agents import PerfectionistAgent
from sade_agents.crews.base_crew import create_task_with_context
from sade_agents.models import QualityAuditInput, QualityAuditOutput, AuditResult


class QualityAuditCrew:
    """
    Kalite denetimi workflow'u.

    Pipeline: Perfectionist (tek agent)
    Kullanim: Herhangi bir icerigi marka tutarliligi icin denetle

    Bu en basit crew - sadece Perfectionist kullanir.
    Diger agent'larin ciktilarini denetlemek icin kullanilir.
    """

    def __init__(self) -> None:
        """Agent'i olusturur."""
        self.perfectionist = PerfectionistAgent()

    def _create_tasks(self, inputs: QualityAuditInput) -> list:
        """Denetim task'i olusturur."""
        audit_task = create_task_with_context(
            description=f"""
Asagidaki icerigi marka tutarliligi icin denetle:

Icerik Turu: {inputs.content_type}
Kaynak Agent: {inputs.source_agent}

ICERIK:
{inputs.content}

Denetim kriterleri:
- Ton uyumu (Sessiz Luks manifestosu)
- Kelime secimi (yasak kelimeler kontrolu)
- Yapi uyumu (format ve uzunluk)

AuditResult formati kullan.
            """,
            expected_output="AuditResult JSON: content_type, source_agent, overall_score, verdict, issues, suggestions, summary_tr",
            agent=self.perfectionist,
        )
        return [audit_task]

    def kickoff(self, inputs: dict) -> QualityAuditOutput:
        """
        Quality audit workflow'unu calistirir.

        Args:
            inputs: QualityAuditInput field'lari

        Returns:
            QualityAuditOutput with audit_result and passed status
        """
        validated_inputs = QualityAuditInput(**inputs)
        tasks = self._create_tasks(validated_inputs)

        crew = Crew(
            agents=[self.perfectionist],
            tasks=tasks,
            process=Process.sequential,
            verbose=True,
        )

        start_time = time.time()
        result = crew.kickoff(inputs=inputs)
        elapsed = time.time() - start_time

        # Parse audit result (in production, parse actual output)
        # For now, create placeholder
        audit_result = AuditResult(
            content_type=validated_inputs.content_type,
            source_agent=validated_inputs.source_agent,
            overall_score=75,  # Placeholder
            tone_score=80,
            vocabulary_score=70,
            structure_score=75,
            verdict="revizyon_gerekli",
            issues=[],
            suggestions=[],
            summary_tr=str(result)[:200],
        )

        return QualityAuditOutput(
            audit_result=audit_result,
            passed=audit_result.overall_score >= 75,
            execution_time_seconds=elapsed,
        )


__all__ = ["QualityAuditCrew"]
```
  </action>
  <verify>
    python -c "from sade_agents.crews.market_analysis_crew import MarketAnalysisCrew; from sade_agents.crews.quality_audit_crew import QualityAuditCrew; print('Both crews imported successfully')"
  </verify>
  <done>
    MarketAnalysisCrew and QualityAuditCrew classes exist and importable
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement SadeCrewFactory and update __init__</name>
  <files>
    src/sade_agents/crews/factory.py
    src/sade_agents/crews/__init__.py
  </files>
  <action>
Create `src/sade_agents/crews/factory.py`:

```python
"""
Sade Chocolate - Crew Factory.

Ozel crew kompozisyonlari olusturur.
"""

from typing import Literal

from sade_agents.crews.product_launch_crew import ProductLaunchCrew
from sade_agents.crews.market_analysis_crew import MarketAnalysisCrew
from sade_agents.crews.quality_audit_crew import QualityAuditCrew


CrewType = Literal["product_launch", "market_analysis", "quality_audit"]


class SadeCrewFactory:
    """
    Sade Chocolate crew kompozisyonlari fabrikasi.

    Kullanim:
        factory = SadeCrewFactory()
        crew = factory.create_product_launch_crew()
        result = crew.kickoff({"flavor_concept": "Ruby Cikolata"})

    Mevcut crew tipleri:
    - product_launch: Alchemist -> Narrator -> Curator -> Perfectionist
    - market_analysis: PricingAnalyst -> GrowthHacker -> Narrator
    - quality_audit: Perfectionist (tek basina)
    """

    def create_product_launch_crew(self) -> ProductLaunchCrew:
        """
        Urun lansmani crew'u olusturur.

        Pipeline: Alchemist -> Narrator -> Curator -> Perfectionist
        Kullanim: Yeni lezzet gelistirme

        Returns:
            ProductLaunchCrew instance
        """
        return ProductLaunchCrew()

    def create_market_analysis_crew(self) -> MarketAnalysisCrew:
        """
        Pazar analizi crew'u olusturur.

        Pipeline: PricingAnalyst -> GrowthHacker -> Narrator
        Kullanim: Rakip istihbarati

        Returns:
            MarketAnalysisCrew instance
        """
        return MarketAnalysisCrew()

    def create_quality_audit_crew(self) -> QualityAuditCrew:
        """
        Kalite denetimi crew'u olusturur.

        Pipeline: Perfectionist (tek)
        Kullanim: Icerik denetimi

        Returns:
            QualityAuditCrew instance
        """
        return QualityAuditCrew()

    def create_crew(self, crew_type: CrewType):
        """
        Tip adina gore crew olusturur.

        Args:
            crew_type: "product_launch", "market_analysis", or "quality_audit"

        Returns:
            Crew instance

        Raises:
            ValueError: Gecersiz crew tipi
        """
        creators = {
            "product_launch": self.create_product_launch_crew,
            "market_analysis": self.create_market_analysis_crew,
            "quality_audit": self.create_quality_audit_crew,
        }

        if crew_type not in creators:
            raise ValueError(f"Gecersiz crew tipi: {crew_type}. Gecerli tipler: {list(creators.keys())}")

        return creators[crew_type]()


__all__ = ["SadeCrewFactory", "CrewType"]
```

Update `src/sade_agents/crews/__init__.py`:

```python
"""
Sade Chocolate - Crew Compositions.

Multi-agent workflow orkestrasyon modulleri.
"""

from sade_agents.crews.base_crew import (
    create_task_with_context,
    timed_execution,
    requires_approval,
)
from sade_agents.crews.factory import SadeCrewFactory, CrewType
from sade_agents.crews.product_launch_crew import ProductLaunchCrew
from sade_agents.crews.market_analysis_crew import MarketAnalysisCrew
from sade_agents.crews.quality_audit_crew import QualityAuditCrew

__all__ = [
    # Factory
    "SadeCrewFactory",
    "CrewType",
    # Crews
    "ProductLaunchCrew",
    "MarketAnalysisCrew",
    "QualityAuditCrew",
    # Utilities
    "create_task_with_context",
    "timed_execution",
    "requires_approval",
]
```
  </action>
  <verify>
    python -c "from sade_agents.crews import SadeCrewFactory; factory = SadeCrewFactory(); print(f'Factory created'); pl = factory.create_product_launch_crew(); ma = factory.create_market_analysis_crew(); qa = factory.create_quality_audit_crew(); print('All 3 crews created via factory')"
  </verify>
  <done>
    SadeCrewFactory creates all 3 crew types, all classes exported from crews package
  </done>
</task>

</tasks>

<verification>
Run all verification commands:
```bash
# Test all imports
python -c "from sade_agents.crews import SadeCrewFactory, ProductLaunchCrew, MarketAnalysisCrew, QualityAuditCrew"

# Test factory pattern
python -c "
from sade_agents.crews import SadeCrewFactory
factory = SadeCrewFactory()
for crew_type in ['product_launch', 'market_analysis', 'quality_audit']:
    crew = factory.create_crew(crew_type)
    print(f'{crew_type}: {type(crew).__name__}')
"

# Verify crews have correct agents
python -c "
from sade_agents.crews import ProductLaunchCrew, MarketAnalysisCrew, QualityAuditCrew
pl = ProductLaunchCrew()
print(f'ProductLaunch agents: alchemist={pl.alchemist.role[:20]}...')
ma = MarketAnalysisCrew()
print(f'MarketAnalysis agents: pricing={ma.pricing.role[:20]}...')
qa = QualityAuditCrew()
print(f'QualityAudit agents: perfectionist={qa.perfectionist.role[:20]}...')
"
```
</verification>

<success_criteria>
- ProductLaunchCrew orchestrates 4 agents with task context dependencies
- MarketAnalysisCrew orchestrates 3 agents with optional trend analysis
- QualityAuditCrew runs single-agent audit workflow
- SadeCrewFactory can create all 3 crew types
- All classes exportable from sade_agents.crews
- Task context dependencies properly configured (context=[prev_task])
</success_criteria>

<output>
After completion, create `.planning/phases/08-orkestrasyon/08-02-SUMMARY.md`
</output>
