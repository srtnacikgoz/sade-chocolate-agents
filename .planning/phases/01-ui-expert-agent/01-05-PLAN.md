---
phase: 01-ui-expert-agent
plan: 05
type: execute
wave: 4
depends_on: ["01-01", "01-04"]
files_modified:
  - src/sade_agents/web/pages/ui_generator.py
  - src/sade_agents/web/components/sidebar.py
autonomous: false

must_haves:
  truths:
    - "UI Generator sayfasi sidebar'dan erisilebilir"
    - "Kullanici Figma URL girebilir"
    - "Sistem Streamlit kodu uretip gosteriyor"
    - "Verification sonucu goruntuleniyor"
  artifacts:
    - path: "src/sade_agents/web/pages/ui_generator.py"
      provides: "UI Generator page"
      min_lines: 100
    - path: "src/sade_agents/web/components/sidebar.py"
      provides: "Updated sidebar with ui_generator nav"
      contains: "ui_generator"
  key_links:
    - from: "src/sade_agents/web/pages/ui_generator.py"
      to: "src/sade_agents/skills/design_skills.py"
      via: "skill import"
      pattern: "fetch_figma_design"
    - from: "src/sade_agents/web/pages/ui_generator.py"
      to: "src/sade_agents/skills/codegen_skills.py"
      via: "skill import"
      pattern: "generate_streamlit_code|verify_generated_code"
    - from: "src/sade_agents/web/components/sidebar.py"
      to: "ui_generator page"
      via: "navigation pages dict"
      pattern: "ui_generator.*UI Generator"
---

<objective>
UI Generator Page ve Integration - Streamlit UI + sidebar entegrasyonu.

Purpose: Kullanicinin Figma URL'si girerek Streamlit kodu uretmesini saglayan web arayuzu.
Tum Phase 1 component'larini (reference library, skills, agent) bir araya getirir.

Output: Calisan UI Generator sayfasi + sidebar navigasyonu
</objective>

<execution_context>
@C:\Users\Hp\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Hp\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-ui-expert-agent/01-RESEARCH.md

# Mevcut page pattern'lari
@src/sade_agents/web/pages/home.py
@src/sade_agents/web/pages/product_launch.py

# Sidebar (guncellenecek)
@src/sade_agents/web/components/sidebar.py

# Skills (onceki plan'lardan)
@src/sade_agents/skills/design_skills.py
@src/sade_agents/skills/codegen_skills.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: UI Generator Page</name>
  <files>src/sade_agents/web/pages/ui_generator.py</files>
  <action>
UI Generator sayfasi olustur - mevcut page pattern'lari takip et:

```python
"""
Sade Agents - UI Generator Page.

Figma tasarimindan Streamlit component kodu ureten sayfa.
UI Expert Agent'in skill'lerini kullanir.
"""

import json
import streamlit as st

from sade_agents.skills.design_skills import fetch_figma_design, extract_design_tokens
from sade_agents.skills.codegen_skills import (
    generate_streamlit_code,
    verify_generated_code,
    load_reference_examples,
)


def render_ui_generator_page() -> None:
    """
    UI Generator sayfasini render eder.

    Kullanici Figma URL girer, sistem:
    1. Tasarim verisini ceker
    2. Design token'lari cikarir
    3. Reference ornekleri yukler
    4. Streamlit kodu uretir
    5. Kodu dogrular
    6. Sonuclari gosterir
    """
    st.title("ğŸ¨ UI Generator")
    st.markdown("Figma tasarimindan Streamlit component kodu uretin.")

    # Session state init
    if "generated_code" not in st.session_state:
        st.session_state.generated_code = None
    if "verification_result" not in st.session_state:
        st.session_state.verification_result = None
    if "design_data" not in st.session_state:
        st.session_state.design_data = None

    st.markdown("---")

    # === Input Section ===
    st.subheader("1. Tasarim Bilgileri")

    col1, col2 = st.columns([2, 1])

    with col1:
        figma_url = st.text_input(
            "Figma Frame URL",
            placeholder="Orn: https://www.figma.com/file/abc123/Design?node-id=1:2",
            help="Figma'da frame'i sec, sag tik -> Copy link",
        )

    with col2:
        component_type = st.selectbox(
            "Component Tipi",
            options=["card", "form", "data_table", "page"],
            help="Uretilecek component tipi",
        )

    component_name = st.text_input(
        "Fonksiyon Adi",
        placeholder="Orn: render_product_card",
        help="snake_case format (render_xxx)",
    )

    # Validation
    url_valid = figma_url and "figma.com" in figma_url
    name_valid = component_name and "_" in component_name and component_name.islower().replace("_", "")

    # === Generate Button ===
    st.markdown("---")

    col_btn1, col_btn2 = st.columns([1, 3])

    with col_btn1:
        generate_clicked = st.button(
            "ğŸš€ Kod Uret",
            type="primary",
            disabled=not (url_valid and name_valid),
            use_container_width=True,
        )

    if not url_valid and figma_url:
        st.warning("Gecerli bir Figma URL girin (figma.com icermeli)")
    if not name_valid and component_name:
        st.warning("Fonksiyon adi snake_case olmali (orn: render_my_card)")

    # === Generation Flow ===
    if generate_clicked and url_valid and name_valid:
        _run_generation_flow(figma_url, component_type, component_name)

    # === Results Section ===
    if st.session_state.generated_code:
        _render_results_section()


def _run_generation_flow(
    figma_url: str,
    component_type: str,
    component_name: str,
) -> None:
    """Kod uretim flow'unu calistirir."""

    progress = st.progress(0)
    status = st.empty()

    try:
        # Step 1: Fetch design
        status.info("ğŸ“¥ Figma'dan tasarim cekiliyor...")
        progress.progress(20)
        design_json = fetch_figma_design(figma_url)
        st.session_state.design_data = json.loads(design_json)

        # Step 2: Extract tokens
        status.info("ğŸ¨ Design token'lar cikariliyor...")
        progress.progress(40)
        tokens_json = extract_design_tokens(design_json)

        # Step 3: Load references
        status.info("ğŸ“š Reference ornekler yukleniyor...")
        progress.progress(50)
        references = load_reference_examples(component_type)

        # Step 4: Generate code
        status.info("âš¡ Streamlit kodu uretiliyor...")
        progress.progress(70)
        code = generate_streamlit_code(design_json, component_type, component_name)
        st.session_state.generated_code = code

        # Step 5: Verify
        status.info("âœ… Kod dogrulaniyor...")
        progress.progress(90)
        verification = verify_generated_code(code)
        st.session_state.verification_result = json.loads(verification)

        progress.progress(100)
        status.success("Kod basariyla uretildi!")

    except Exception as e:
        status.error(f"Hata: {e}")
        st.session_state.generated_code = None
        st.session_state.verification_result = None


def _render_results_section() -> None:
    """Sonuclari gosterir."""

    st.markdown("---")
    st.subheader("2. Sonuclar")

    # Tabs: Code, Verification, Design Data
    tab_code, tab_verify, tab_design = st.tabs(["ğŸ“ Kod", "âœ… Dogrulama", "ğŸ¨ Design"])

    with tab_code:
        st.markdown("**Uretilen Streamlit Kodu:**")
        st.code(st.session_state.generated_code, language="python")

        # Copy button workaround
        st.download_button(
            label="ğŸ“‹ Kodu Kopyala (Download)",
            data=st.session_state.generated_code,
            file_name="generated_component.py",
            mime="text/x-python",
        )

    with tab_verify:
        result = st.session_state.verification_result

        if result:
            if result.get("valid"):
                st.success("âœ… Kod dogrulama basarili!")
            else:
                st.warning("âš ï¸ Bazi sorunlar bulundu")

            # Issues
            if result.get("issues"):
                st.markdown("**Sorunlar:**")
                for issue in result["issues"]:
                    st.error(f"â€¢ {issue}")

            # Suggestions
            if result.get("suggestions"):
                st.markdown("**Oneriler:**")
                for suggestion in result["suggestions"]:
                    st.info(f"ğŸ’¡ {suggestion}")

    with tab_design:
        if st.session_state.design_data:
            st.json(st.session_state.design_data)
        else:
            st.info("Design data yok")

    # === Reference Examples (Expandable) ===
    with st.expander("ğŸ“š Reference Ornekler", expanded=False):
        examples = load_reference_examples("all")
        st.code(examples, language="python")


__all__ = ["render_ui_generator_page"]
```
  </action>
  <verify>python -c "from src.sade_agents.web.pages.ui_generator import render_ui_generator_page; print('OK')"</verify>
  <done>UI Generator sayfasi import edilebilir, generation flow implement edilmis</done>
</task>

<task type="auto">
  <name>Task 2: Sidebar Navigation Update</name>
  <files>src/sade_agents/web/components/sidebar.py</files>
  <action>
Sidebar'a UI Generator sayfasi ekle:

Mevcut sidebar.py dosyasini oku, pages dict'e "ui_generator" ekle:

```python
pages = {
    "home": ("ğŸ ", "Ana Sayfa"),
    "product_launch": ("ğŸš€", "Urun Lansmani"),
    "market_analysis": ("ğŸ“Š", "Pazar Analizi"),
    "quality_audit": ("âœ…", "Kalite Denetimi"),
    "competitors": ("ğŸ¯", "Rakip Yonetimi"),
    "ui_generator": ("ğŸ¨", "UI Generator"),  # YENi
    "history": ("ğŸ“œ", "Gecmis"),
}
```

Footer version'i guncelle: v1.1.0 -> v1.1.1
  </action>
  <verify>python -c "from src.sade_agents.web.components.sidebar import render_sidebar; print('OK')"</verify>
  <done>Sidebar'da ui_generator navigasyonu mevcut</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: UI Generator Integration Test</name>
  <what-built>
UI Generator sayfasi - Figma URL'den Streamlit kodu ureten tam workflow:
- Figma URL input
- Component type secimi
- Kod uretimi (design_skills + codegen_skills)
- Verification sonuclari
- Reference ornekler
  </what-built>
  <how-to-verify>
1. Streamlit uygulamasini calistir:
   ```bash
   cd C:/dev/sade-chocolate-agents
   streamlit run src/sade_agents/web/app.py
   ```

2. Sol menuden "ğŸ¨ UI Generator" sayfasina git

3. Test degerleri gir:
   - Figma URL: https://www.figma.com/file/test123/My-Design?node-id=1:2
   - Component Tipi: card
   - Fonksiyon Adi: render_test_card

4. "ğŸš€ Kod Uret" butonuna tikla

5. Dogrula:
   - Progress bar ilerliyor
   - Kod tab'inda Python kodu gorunuyor
   - Dogrulama tab'inda sonuc gorunuyor
   - Design tab'inda JSON gorunuyor

6. Reference Ornekler expander'ini ac, 3 reference component goruntulenmeli
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
```bash
# Syntax check
python -m py_compile src/sade_agents/web/pages/ui_generator.py

# Import check
python -c "from src.sade_agents.web.pages.ui_generator import render_ui_generator_page; print('Page OK')"
python -c "from src.sade_agents.web.components.sidebar import render_sidebar; print('Sidebar OK')"

# Full integration (requires streamlit run manually)
```
</verification>

<success_criteria>
- ui_generator.py dosyasi mevcut ve import edilebilir
- Sidebar'da "UI Generator" navigasyonu var
- Sayfa Figma URL input kabul ediyor
- Kod uretim flow'u calisiyor (mock data ile)
- Verification sonuclari goruntuleniyor
- Reference ornekler yuklenip goruntuleniyor
- Kullanici manuel test onayliyor
</success_criteria>

<output>
After completion, create `.planning/phases/01-ui-expert-agent/01-05-SUMMARY.md`
</output>
