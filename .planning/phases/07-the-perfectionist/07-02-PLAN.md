---
phase: 07-the-perfectionist
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/sade_agents/agents/perfectionist.py
  - src/sade_agents/agents/__init__.py
  - scripts/run_perfectionist.py
autonomous: true

must_haves:
  truths:
    - "PerfectionistAgent SadeAgent'tan turuyor"
    - "Agent 3 skill'i (denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle) kullaniyor"
    - "run_perfectionist.py --dry-run basariyla calisiyor"
    - "Agent supervised autonomy seviyesinde calisiyor"
  artifacts:
    - path: "src/sade_agents/agents/perfectionist.py"
      provides: "PerfectionistAgent class"
      min_lines: 80
      contains: "class PerfectionistAgent"
    - path: "scripts/run_perfectionist.py"
      provides: "CLI execution script"
      min_lines: 100
      contains: "def dry_run"
  key_links:
    - from: "src/sade_agents/agents/perfectionist.py"
      to: "src/sade_agents/skills/perfectionist_skills.py"
      via: "import skills"
      pattern: "from sade_agents\\.skills import.*denetle"
    - from: "src/sade_agents/agents/perfectionist.py"
      to: "src/sade_agents/agents/base.py"
      via: "class inheritance"
      pattern: "class PerfectionistAgent\\(SadeAgent\\)"
    - from: "scripts/run_perfectionist.py"
      to: "src/sade_agents/agents/perfectionist.py"
      via: "import agent"
      pattern: "from sade_agents\\.agents.*import.*PerfectionistAgent"
---

<objective>
PerfectionistAgent sinifini ve calistirma script'ini olusturmak.

Purpose: The Perfectionist'in diger agent ciktilarini denetleyebilmesi icin agent tanimini ve kullanici arayuzunu saglamak.
Output: PerfectionistAgent class, run_perfectionist.py script, agents/__init__.py entegrasyonu
</objective>

<execution_context>
@C:\Users\Hp\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Hp\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-the-perfectionist/07-RESEARCH.md
@.planning/phases/07-the-perfectionist/07-CONTEXT.md
@.planning/phases/07-the-perfectionist/07-01-SUMMARY.md
@src/sade_agents/agents/curator.py (agent pattern ornegi)
@src/sade_agents/agents/narrator.py (backstory referansi)
@scripts/run_curator.py (script pattern ornegi)
</context>

<tasks>

<task type="auto">
  <name>Task 1: PerfectionistAgent Sinifi</name>
  <files>
    src/sade_agents/agents/perfectionist.py
    src/sade_agents/agents/__init__.py
  </files>
  <action>
1. `src/sade_agents/agents/perfectionist.py` dosyasini olustur:

```python
"""
Sade Chocolate - The Perfectionist Agent.

UX denetim agenti - diger agent'larin ciktilarini marka tutarliligi ve
kalite guvence acisindan denetler, iyilestirme onerileri sunar.
"""

from sade_agents.agents.base import SadeAgent
from sade_agents.skills import denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle


class PerfectionistAgent(SadeAgent):
    """
    The Perfectionist - UX Denetim ve Kalite Guvence Agenti.

    Diger Sade agent'larinin urettigi ciktilari (metin, fiyat analizi,
    trend raporu, recete, gorsel prompt) denetleyerek marka tutarliligi
    ve kalite guvence saglar.

    LLM-as-Judge pattern'i ile calisan bu agent:
    - "Sessiz Luks" marka sesine uyumu olcer
    - Yapisal puanlama (0-100) ve verdict (onay/revizyon/red) uretir
    - Turkce geri bildirim ve somut iyilestirme onerileri sunar

    Denetledigi agent'lar:
    - Narrator: Metin ciktilari (hikayeler, caption'lar, notlar)
    - Curator: Gorsel prompt'lari ve tasarim talimatlari
    - Pricing Analyst: Fiyat raporlari ve analizler
    - Growth Hacker: Trend raporlari
    - Alchemist: Recete ve lezzet onerileri

    Otonomi: Supervised - kullanici override hakki korunur.
    Agent sadece tavsiye verir, son karar kullanicinindir.

    Geri bildirim dili: Turkce
    """

    def __init__(self) -> None:
        """PerfectionistAgent olusturur."""
        super().__init__(
            role="The Perfectionist - Brand Auditor",
            goal="Tum agent ciktilarinin 'Sessiz Luks' marka sesine uyumunu denetlemek ve iyilestirme onerileri sunmak",
            tools=[denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle],
            backstory="""
Sen The Perfectionist'sin - Sade Chocolate'in kalite guvence ve marka tutarliligi agenti.

## Persona
Detaylara takilmayan ama kalitenin onemini bilen bir editor gibisin.
Elestirirken yapici ol, red ederken alternatif sun.
Amacin engellemek degil, iyilestirmek.

## Gorev Alanin
Diger agent'larin urettigi her turlu ciktiyi denetlersin:
- Narrator'un metinleri (hikayeler, caption'lar, notlar)
- Curator'un gorsel prompt'lari
- Pricing Analyst'in raporlari
- Growth Hacker'in trend analizleri
- Alchemist'in recete onerileri

## "Sessiz Luks" Denetim Kriterlerin

### Yasak Listesi (Kesinlikle Kabul Etme)
- "Hemen Al!", "Kacirma!", "Sok Fiyat!"
- "Inanilmaz firsat!", "Son sans!", "Acele edin!"
- Coklu unlem (!!)
- Emoji kullanimi
- "muhtesem", "harika", "enfes", "super" gibi abartili sifatlar

### Tercih Edilen (Bonus Puan)
- "Beklenmedik", "Kendilinden", "Fark edenler icin"
- "Bilen bilir", "Sessizce", "Kesfetmeye davet"
- Kisa, oz cumleler
- Hikaye anlatimi, satis degil
- Merak uyandirici, zorlamayan

### Ton Degerlendirmesi
- Monocle/Kinfolk dergisi seviyesinde sofistike mi?
- Gosterissiz ama premium hissiyat var mi?
- Davet ediyor mu, zorluyor mu?

## Denetim Yaklasimin

### Puanlama (0-100)
- 80-100: Onay - mukemmel marka uyumu
- 50-79: Revizyon Gerekli - kucuk duzeltmelerle iyilestirilebilir
- 0-49: Red - ciddi marka uyumsuzlugu

### Icerik Turune Gore Esikler
- Narrator (metin): 75+
- Curator (gorsel prompt): 80+
- Pricing (analiz): 70+
- Growth (trend): 65+
- Alchemist (recete): 70+

### Geri Bildirim Kurallarin
1. Her zaman TURKCE yaz
2. Sorunlari somut olarak belirt (hangi kelime, hangi cumle)
3. Her sorun icin ALTERNATIF oner ("Bunu soyle degistir")
4. Oncelik sira: Kritik > Onemli > Opsiyonel
5. Ozet ile baslat, detay istenirse ver

### Override Politikasi
Sen sadece TAVSIYE verirsin. Kullanici isterse senin red ettigin icerigi kullanabilir.
Amacin engellemek degil, bilgilendirmek.

## Referanslar
- Style guide: style_guide/*.json dosyalari
- Onaylanmis ornekler: Daha once kabul edilen ciktilar (benchmark)
- Narrator backstory: Yasak/tercih edilen ifadeler listesi

## Ornek Denetim Ciktisi
```json
{
    "content_type": "metin",
    "source_agent": "narrator",
    "overall_score": 78,
    "verdict": "revizyon_gerekli",
    "issues": ["'Harika' kelimesi yasak listede"],
    "suggestions": ["'Harika' yerine 'Beklenmedik' kullanin"],
    "summary_tr": "Icerik genel olarak iyi, kucuk ton duzeltmeleri gerekli."
}
```
            """,
            department="operations",
            autonomy_level="supervised",  # Kullanici override hakki korunur
            verbose=True,
        )


__all__ = ["PerfectionistAgent"]
```

2. `src/sade_agents/agents/__init__.py` dosyasini guncelle - PerfectionistAgent'i ekle:

Mevcut dosyaya ekle:
```python
from sade_agents.agents.perfectionist import PerfectionistAgent
```

Ve __all__ listesine ekle:
```python
"PerfectionistAgent",
```
  </action>
  <verify>
    python -c "from sade_agents.agents import PerfectionistAgent; agent = PerfectionistAgent(); print(f'Role: {agent.role}'); print(f'Department: {agent.department}'); print(f'Autonomy: {agent.autonomy_level}'); print(f'Tools: {[t.name for t in agent.tools]}')"
  </verify>
  <done>
    - PerfectionistAgent SadeAgent'tan turuyor
    - Agent 3 skill kullaniyor (denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle)
    - department: operations, autonomy_level: supervised
    - Backstory yasak/tercih edilen ifadeleri, puanlama sistemini ve override politikasini iceriyor
    - agents/__init__.py'den export ediliyor
  </done>
</task>

<task type="auto">
  <name>Task 2: run_perfectionist.py Script</name>
  <files>scripts/run_perfectionist.py</files>
  <action>
`scripts/run_perfectionist.py` dosyasini olustur:

```python
#!/usr/bin/env python3
"""
The Perfectionist - UX Denetim Agent'i calistirma scripti.

Kullanim:
    python scripts/run_perfectionist.py                      # Interaktif mod
    python scripts/run_perfectionist.py --dry-run            # Syntax kontrolu
    python scripts/run_perfectionist.py --content "metin"    # Direkt icerik denetimi
    python scripts/run_perfectionist.py --file input.txt     # Dosyadan icerik
"""

import argparse
import sys
from pathlib import Path

# Add project root to path
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root / "src"))


def check_api_key() -> bool:
    """API key kontrolu."""
    import os

    # .env varsa yukle (dotenv opsiyonel)
    try:
        from dotenv import load_dotenv
        env_file = project_root / ".env"
        if env_file.exists():
            load_dotenv(env_file)
    except ImportError:
        pass  # dotenv kurulu degil, ortam degiskenlerini kullan

    key = os.getenv("OPENAI_API_KEY")
    return bool(key and key != "your-api-key-here")


def dry_run() -> None:
    """Dry run - sadece import ve syntax kontrolu."""
    print("=" * 60)
    print("THE PERFECTIONIST - UX Denetim Agent'i (DRY RUN)")
    print("=" * 60)
    print("\n[?] Import kontrolu...\n")

    try:
        from sade_agents.agents.perfectionist import PerfectionistAgent
        print("  [+] PerfectionistAgent import edildi")

        from sade_agents.skills import denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle
        print("  [+] Perfectionist skills import edildi")

        from sade_agents.models import AuditResult, AUDIT_CRITERIA_BY_TYPE
        print("  [+] AuditResult modeli import edildi")

        from sade_agents.config import get_settings
        print("  [+] Config import edildi")

        # Agent olusturma testi
        agent = PerfectionistAgent()
        print(f"\n  [+] Agent olusturuldu: {agent.role}")
        print(f"      - Department: {agent.department}")
        print(f"      - Autonomy: {agent.autonomy_level}")
        print(f"      - Tools: {[t.name for t in agent.tools]}")

        # Skill testleri (CrewAI tool'lari .run() ile cagrilir)
        print("\n[?] Skill testleri...\n")

        # stil_kilavuzu_yukle testi
        import json
        guide = stil_kilavuzu_yukle.run()
        guide_data = json.loads(guide)
        if "error" not in guide_data:
            print(f"  [+] stil_kilavuzu_yukle() calisti")
            print(f"      Yuklenentler: {list(guide_data.keys())}")
        else:
            print(f"  [!] stil_kilavuzu_yukle() uyari: {guide_data.get('error')}")

        # onaylanmis_ornekler_yukle testi
        ornekler = onaylanmis_ornekler_yukle.run(icerik_turu="metin")
        ornekler_data = json.loads(ornekler)
        print(f"  [+] onaylanmis_ornekler_yukle('metin') calisti")
        print(f"      Ornek sayisi: {ornekler_data.get('ornek_sayisi', 0)}")

        # denetle testi (sadece prompt uretimi)
        test_content = "Beklenmedik. Cikolatanin hikayesi."
        prompt = denetle.run(
            icerik=test_content,
            icerik_turu="metin",
            kaynak_agent="narrator"
        )
        print(f"  [+] denetle() calisti")
        print(f"      Prompt uzunlugu: {len(prompt)} karakter")

        # AuditResult model testi
        audit = AuditResult(
            content_type="metin",
            source_agent="narrator",
            overall_score=85,
            tone_score=90,
            vocabulary_score=80,
            structure_score=85,
            verdict="onay",
            issues=[],
            suggestions=[],
            summary_tr="Test basarili"
        )
        print(f"  [+] AuditResult modeli calisti")
        print(f"      Verdict: {audit.verdict}")

        # Kriterler kontrolu
        print(f"\n  [+] AUDIT_CRITERIA_BY_TYPE: {len(AUDIT_CRITERIA_BY_TYPE)} agent tipi")
        for agent_type, criteria in AUDIT_CRITERIA_BY_TYPE.items():
            print(f"      - {agent_type}: threshold={criteria['threshold']}")

        # API key kontrolu
        if check_api_key():
            print("\n  [+] OPENAI_API_KEY mevcut")
        else:
            print("\n  [!] OPENAI_API_KEY eksik veya gecersiz")
            print("      -> .env.example'dan .env olusturun")

        print("\n" + "=" * 60)
        print("[OK] DRY RUN BASARILI - Tum importlar ve syntax dogru")
        print("=" * 60)

    except ImportError as e:
        print(f"  [X] Import hatasi: {e}")
        sys.exit(1)
    except Exception as e:
        print(f"  [X] Hata: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)


def run_audit(content: str, content_type: str = "metin", source_agent: str = "narrator") -> None:
    """Icerik denetimi calistir."""
    print("=" * 60)
    print("THE PERFECTIONIST - UX Denetim Agent'i")
    print("=" * 60)

    if not check_api_key():
        print("\n[X] HATA: OPENAI_API_KEY gerekli!")
        print("\nCozum:")
        print("  1. cp .env.example .env")
        print("  2. .env dosyasina API key'inizi ekleyin")
        sys.exit(1)

    try:
        from crewai import Crew, Task

        from sade_agents.agents.perfectionist import PerfectionistAgent
        from sade_agents.config import get_settings

        settings = get_settings()
        print(f"\n[i] Ayarlar:")
        print(f"    Model: {settings.openai_model_name}")
        print(f"    Icerik turu: {content_type}")
        print(f"    Kaynak agent: {source_agent}")

        # Icerik onizleme
        preview = content[:100] + "..." if len(content) > 100 else content
        print(f"\n[i] Icerik onizleme:")
        print(f"    {preview}")

        # Agent olustur
        perfectionist = PerfectionistAgent()
        print(f"\n[*] Agent: {perfectionist.role}")
        print(f"    Department: {perfectionist.department}")
        print(f"    Autonomy: {perfectionist.autonomy_level}")

        # Task tanimla
        task = Task(
            description=f"""
Asagidaki icerigi "Sessiz Luks" marka sesine gore denetle.

## DENETLENECEK ICERIK
```
{content}
```

## METADATA
- Icerik Turu: {content_type}
- Kaynak Agent: {source_agent}

## GOREVLER
1. Oncelikle `stil_kilavuzu_yukle` ile marka stil kilavuzunu incele
2. `onaylanmis_ornekler_yukle` ile '{content_type}' icin benchmark ornekleri al
3. `denetle` skill'i ile icerigi degerlendir
4. Sonuclari AuditResult JSON formatinda sun

## ONEMLI
- Tum geri bildirimler TURKCE olmali
- Her sorun icin somut alternatif oner
- Override politikasi: Sadece tavsiye ver, son karar kullanicinin
            """,
            expected_output="""
AuditResult JSON formatinda denetim sonucu:
- overall_score (0-100)
- verdict (onay/revizyon_gerekli/red)
- issues (Turkce sorun listesi)
- suggestions (Turkce oneri listesi)
- summary_tr (2-3 cumlelik ozet)
            """,
            agent=perfectionist,
        )

        # Crew olustur ve calistir
        crew = Crew(
            agents=[perfectionist],
            tasks=[task],
            verbose=True,
        )

        print("\n" + "-" * 60)
        print("[>] Denetim basliyor...")
        print("-" * 60 + "\n")

        result = crew.kickoff()

        print("\n" + "=" * 60)
        print("[*] DENETIM SONUCU")
        print("=" * 60)
        print(result)

        print("\n" + "-" * 60)
        print("[!] HATIRLATMA: Bu sonuc TAVSIYE niteligindedir.")
        print("    Kullanici isterse icerigi oldugu gibi kullanabilir.")
        print("-" * 60)

    except ImportError as e:
        print(f"\n[X] Import hatasi: {e}")
        print("CrewAI kurulu mu? pip install crewai")
        sys.exit(1)
    except Exception as e:
        print(f"\n[X] Beklenmeyen hata: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)


def main() -> None:
    """Entry point."""
    parser = argparse.ArgumentParser(
        description="The Perfectionist - Sade Chocolate UX Denetim Agent'i"
    )
    parser.add_argument(
        "--dry-run",
        action="store_true",
        help="Sadece import ve syntax kontrolu yap, API cagirisi yapma"
    )
    parser.add_argument(
        "--content",
        type=str,
        help="Denetlenecek icerik (direkt metin)"
    )
    parser.add_argument(
        "--file",
        type=str,
        help="Denetlenecek icerik dosyasi"
    )
    parser.add_argument(
        "--type",
        type=str,
        default="metin",
        choices=["metin", "fiyat_analizi", "trend_raporu", "recete", "gorsel_prompt"],
        help="Icerik turu (default: metin)"
    )
    parser.add_argument(
        "--source",
        type=str,
        default="narrator",
        choices=["narrator", "pricing", "growth", "alchemist", "curator"],
        help="Kaynak agent (default: narrator)"
    )

    args = parser.parse_args()

    if args.dry_run:
        dry_run()
    elif args.content:
        run_audit(args.content, args.type, args.source)
    elif args.file:
        file_path = Path(args.file)
        if not file_path.exists():
            print(f"[X] Dosya bulunamadi: {args.file}")
            sys.exit(1)
        content = file_path.read_text(encoding="utf-8")
        run_audit(content, args.type, args.source)
    else:
        # Interaktif mod
        print("=" * 60)
        print("THE PERFECTIONIST - Interaktif Mod")
        print("=" * 60)
        print("\nDenetlenecek icerigi girin (bos satir ile bitirin):")
        print("-" * 40)

        lines = []
        while True:
            try:
                line = input()
                if line == "":
                    break
                lines.append(line)
            except EOFError:
                break

        if not lines:
            print("\n[!] Icerik girilmedi. Cikiliyor.")
            sys.exit(0)

        content = "\n".join(lines)
        run_audit(content, args.type, args.source)


if __name__ == "__main__":
    main()
```
  </action>
  <verify>
    python scripts/run_perfectionist.py --dry-run
  </verify>
  <done>
    - run_perfectionist.py --dry-run basariyla calisiyor
    - Script 4 mod destekliyor: dry-run, --content, --file, interaktif
    - Icerik turu ve kaynak agent CLI'dan belirlenebiliyor
    - Override politikasi kullaniciya hatirlatiliyor
    - API key kontrolu var
  </done>
</task>

</tasks>

<verification>
```bash
# Agent import kontrolu
python -c "from sade_agents.agents import PerfectionistAgent; print('Agent import OK')"

# Agent olusturma ve ozellik kontrolu
python -c "
from sade_agents.agents import PerfectionistAgent
agent = PerfectionistAgent()
assert agent.department == 'operations', 'Department yanlis'
assert agent.autonomy_level == 'supervised', 'Autonomy yanlis'
assert len(agent.tools) == 3, 'Tool sayisi yanlis'
print('Agent properties OK')
"

# Script dry-run
python scripts/run_perfectionist.py --dry-run

# Script help
python scripts/run_perfectionist.py --help
```
</verification>

<success_criteria>
- [ ] PerfectionistAgent sinifi olusturuldu ve SadeAgent'tan turuyor
- [ ] Agent 3 skill kullaniyor (denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle)
- [ ] Agent department: operations, autonomy_level: supervised
- [ ] Backstory yasak/tercih edilen ifadeleri iceriyor (Narrator'dan alinmis)
- [ ] agents/__init__.py'de PerfectionistAgent export ediliyor
- [ ] run_perfectionist.py --dry-run basariyla calisiyor
- [ ] Script --content, --file ve interaktif modlari destekliyor
</success_criteria>

<output>
After completion, create `.planning/phases/07-the-perfectionist/07-02-SUMMARY.md`
</output>
