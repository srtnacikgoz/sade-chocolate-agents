---
phase: 07-the-perfectionist
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/sade_agents/models/__init__.py
  - src/sade_agents/models/audit_result.py
  - src/sade_agents/skills/perfectionist_skills.py
  - src/sade_agents/skills/__init__.py
autonomous: true

must_haves:
  truths:
    - "AuditResult modeli JSON olarak serialize edilebilir"
    - "denetle() skill'i icerik turune gore denetim yapar"
    - "stil_kilavuzu_yukle() mevcut style guide dosyalarini okur"
    - "onaylanmis_ornekler_yukle() benchmark ornekleri dondurur"
  artifacts:
    - path: "src/sade_agents/models/audit_result.py"
      provides: "AuditResult Pydantic model, AUDIT_CRITERIA_BY_TYPE"
      min_lines: 50
      contains: "class AuditResult"
    - path: "src/sade_agents/skills/perfectionist_skills.py"
      provides: "denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle skills"
      min_lines: 100
      exports: ["denetle", "stil_kilavuzu_yukle", "onaylanmis_ornekler_yukle"]
  key_links:
    - from: "src/sade_agents/skills/perfectionist_skills.py"
      to: "src/sade_agents/models/audit_result.py"
      via: "import AuditResult"
      pattern: "from sade_agents\\.models.*import.*AuditResult"
    - from: "src/sade_agents/skills/perfectionist_skills.py"
      to: "style_guide/*.json"
      via: "Path ve json.load"
      pattern: "style_guide"
---

<objective>
Perfectionist agent icin temel veri modeli ve skill fonksiyonlarini olusturmak.

Purpose: Denetim sonuclarinin yapisal olarak temsil edilmesi ve marka tutarliligi kontrolu icin gerekli araclarin saglenmasi.
Output: AuditResult Pydantic modeli ve 3 skill fonksiyonu (denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle)
</objective>

<execution_context>
@C:\Users\Hp\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Hp\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-the-perfectionist/07-RESEARCH.md
@.planning/phases/07-the-perfectionist/07-CONTEXT.md
@src/sade_agents/agents/narrator.py (yasak/tercih edilen ifadeler referansi)
@src/sade_agents/skills/curator_skills.py (skill pattern ornegi)
@style_guide/brand_colors.json
@style_guide/typography.json
@style_guide/style_config.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: AuditResult Pydantic Modeli ve Denetim Kriterleri</name>
  <files>
    src/sade_agents/models/__init__.py
    src/sade_agents/models/audit_result.py
  </files>
  <action>
1. `src/sade_agents/models/` klasorunu olustur (yoksa)

2. `src/sade_agents/models/audit_result.py` dosyasini olustur:

```python
"""
Sade Chocolate - Audit Result Models.

Denetim sonuclari icin Pydantic modelleri.
The Perfectionist agent'in cikti formati.
"""

from typing import Literal
from pydantic import BaseModel, Field


class AuditResult(BaseModel):
    """
    Denetim sonucu yapisal modeli.

    The Perfectionist agent'in her denetim icin urettigi standart cikti.
    JSON olarak serialize edilebilir, type-safe.
    """

    content_type: Literal["metin", "fiyat_analizi", "trend_raporu", "recete", "gorsel_prompt"]
    source_agent: Literal["narrator", "pricing", "growth", "alchemist", "curator"]

    # Puanlama (0-100)
    overall_score: int = Field(ge=0, le=100, description="Genel marka uyum puani")
    tone_score: int = Field(ge=0, le=100, description="Ton uyumu puani")
    vocabulary_score: int = Field(ge=0, le=100, description="Kelime secimi puani")
    structure_score: int = Field(ge=0, le=100, description="Yapi uyumu puani")

    # Karar
    verdict: Literal["onay", "revizyon_gerekli", "red"] = Field(
        description="onay: 80+, revizyon_gerekli: 50-79, red: <50"
    )

    # Geri bildirim
    issues: list[str] = Field(default_factory=list, description="Tespit edilen sorunlar (Turkce)")
    suggestions: list[str] = Field(default_factory=list, description="Somut iyilestirme onerileri (Turkce)")
    summary_tr: str = Field(description="2-3 cumlelik Turkce ozet")

    class Config:
        json_schema_extra = {
            "example": {
                "content_type": "metin",
                "source_agent": "narrator",
                "overall_score": 78,
                "tone_score": 85,
                "vocabulary_score": 70,
                "structure_score": 80,
                "verdict": "revizyon_gerekli",
                "issues": ["'Harika' kelimesi yasak listede"],
                "suggestions": ["'Harika' yerine 'Beklenmedik' kullanin"],
                "summary_tr": "Icerik genel olarak iyi, kucuk ton duzeltmeleri gerekli."
            }
        }


# Icerik turune gore denetim kriterleri
AUDIT_CRITERIA_BY_TYPE: dict[str, dict] = {
    "narrator_output": {
        "kritik": ["yasak_ifadeler", "ton_uyumu", "emoji_kontrolu"],
        "onemli": ["kelime_secimi", "cumle_uzunlugu"],
        "opsiyonel": ["hashtag_formati"],
        "threshold": 75,
    },
    "curator_output": {
        "kritik": ["renk_paleti_uyumu", "tipografi_kurallari", "white_space"],
        "onemli": ["kompozisyon", "text_limit"],
        "opsiyonel": ["referans_uyumu"],
        "threshold": 80,
    },
    "pricing_output": {
        "kritik": ["marka_tonu", "sayisal_dogruluk"],
        "onemli": ["format_tutarliligi"],
        "opsiyonel": [],
        "threshold": 70,
    },
    "alchemist_output": {
        "kritik": ["teknik_dogruluk", "marka_tonu"],
        "onemli": ["aciklama_kalitesi"],
        "opsiyonel": [],
        "threshold": 70,
    },
    "growth_output": {
        "kritik": ["marka_tonu", "uygun_dil"],
        "onemli": ["format_tutarliligi"],
        "opsiyonel": [],
        "threshold": 65,
    }
}


__all__ = ["AuditResult", "AUDIT_CRITERIA_BY_TYPE"]
```

3. `src/sade_agents/models/__init__.py` dosyasini olustur:

```python
"""
Sade Agents - Veri modulleri.

Pydantic modelleri ve veri yapilari.
"""

from sade_agents.models.audit_result import AuditResult, AUDIT_CRITERIA_BY_TYPE

__all__: list[str] = [
    "AuditResult",
    "AUDIT_CRITERIA_BY_TYPE",
]
```
  </action>
  <verify>
    python -c "from sade_agents.models import AuditResult, AUDIT_CRITERIA_BY_TYPE; r = AuditResult(content_type='metin', source_agent='narrator', overall_score=85, tone_score=90, vocabulary_score=80, structure_score=85, verdict='onay', summary_tr='Test'); print(r.model_dump_json(indent=2))"
  </verify>
  <done>
    - AuditResult modeli olusturuldu ve JSON'a serialize edilebiliyor
    - AUDIT_CRITERIA_BY_TYPE dict'i 5 agent tipi icin kriterler iceriyor
    - models/__init__.py export'lari dogru calisiyor
  </done>
</task>

<task type="auto">
  <name>Task 2: Perfectionist Skills Implementasyonu</name>
  <files>
    src/sade_agents/skills/perfectionist_skills.py
    src/sade_agents/skills/__init__.py
  </files>
  <action>
1. `src/sade_agents/skills/perfectionist_skills.py` dosyasini olustur:

```python
"""
Sade Chocolate - The Perfectionist Skills.

UX denetim ve marka tutarliligi kontrolu icin skill fonksiyonlari.
LLM-as-Judge pattern'i ile calisan denetim araclari.
"""

import json
from pathlib import Path
from typing import Literal

from crewai.tools import tool

# Style guide paths
STYLE_GUIDE_DIR = Path(__file__).parent.parent.parent.parent / "style_guide"


@tool
def denetle(
    icerik: str,
    icerik_turu: Literal["metin", "fiyat_analizi", "trend_raporu", "recete", "gorsel_prompt"],
    kaynak_agent: Literal["narrator", "pricing", "growth", "alchemist", "curator"]
) -> str:
    """
    Agent ciktisini 'Sessiz Luks' marka sesine gore denetler.

    Style guide ve onaylanmis ornekleri benchmark olarak kullanir.
    Turkce geri bildirim ve somut iyilestirme onerileri sunar.

    Args:
        icerik: Denetlenecek icerik (metin, JSON, prompt vs.)
        icerik_turu: Icerik tipi (metin, fiyat_analizi, trend_raporu, recete, gorsel_prompt)
        kaynak_agent: Icerigi ureten agent (narrator, pricing, growth, alchemist, curator)

    Returns:
        LLM icin hazir denetim prompt'u (AuditResult formatinda cikti bekler)
    """
    # Icerik turune gore threshold ve kriterler
    thresholds = {
        "metin": 75,
        "fiyat_analizi": 70,
        "trend_raporu": 65,
        "recete": 70,
        "gorsel_prompt": 80,
    }
    threshold = thresholds.get(icerik_turu, 70)

    prompt = f"""
Asagidaki icerigi "Sessiz Luks" marka sesine gore denetle.

## DENETLENECEK ICERIK
```
{icerik}
```

## METADATA
- Icerik Turu: {icerik_turu}
- Kaynak Agent: {kaynak_agent}
- Minimum Esik: {threshold}/100

## DENETIM KRITERLERI

### YASAK IFADELER (Bunlari gormek ciddi puan dusurur)
- "Hemen Al!", "Kacirma!", "Sok Fiyat!", "Inanilmaz firsat!"
- "Son sans!", "Sinirli stok!", "Acele edin!"
- Coklu unlem isareti (!!)
- Emoji kullanimi
- Abartili sifatlar: "muhtesem", "harika", "enfes", "super", "inanilmaz"

### TERCIH EDILEN IFADELER (Bonus puan)
- "Beklenmedik", "Kendilinden", "Kesfetmeye davet"
- "Fark edenler icin", "Bilen bilir", "Sessizce"
- Tek unlem veya hic unlem
- Kisa, oz cumleler

### TON DEGERLENDIRMESI (Monocle/Kinfolk estetigi)
- Sofistike ama gosterissiz
- Hikaye anlatan, satis yapmayan
- Merak uyandiran, zorlamayan
- Premium hissiyat, understated ton

### ICERIK TURUNE OZEL KRITERLER
{"- Gorsel prompt: Renk paleti uyumu, tipografi kurallari, white space" if icerik_turu == "gorsel_prompt" else ""}
{"- Metin: Cumle uzunlugu, kelime secimi, emoji kontrolu" if icerik_turu == "metin" else ""}
{"- Fiyat analizi: Sayisal dogruluk, format tutarliligi" if icerik_turu == "fiyat_analizi" else ""}
{"- Recete: Teknik dogruluk, aciklama kalitesi" if icerik_turu == "recete" else ""}
{"- Trend raporu: Uygun dil, format tutarliligi" if icerik_turu == "trend_raporu" else ""}

## BEKLENEN CIKTI FORMATI

Asagidaki JSON formatinda cikti uret:

{{
    "content_type": "{icerik_turu}",
    "source_agent": "{kaynak_agent}",
    "overall_score": <0-100 arasi genel puan>,
    "tone_score": <0-100 arasi ton uyumu>,
    "vocabulary_score": <0-100 arasi kelime secimi>,
    "structure_score": <0-100 arasi yapi uyumu>,
    "verdict": "<onay (80+) | revizyon_gerekli (50-79) | red (<50)>",
    "issues": ["Sorun 1 (Turkce)", "Sorun 2 (Turkce)"],
    "suggestions": ["Oneri 1 - somut alternatif (Turkce)", "Oneri 2 (Turkce)"],
    "summary_tr": "2-3 cumlelik Turkce ozet"
}}

## ONEMLI KURALLAR
1. Tum geri bildirimler TURKCE olmali
2. Her sorun icin SOMUT alternatif oner
3. Verdict esik degerine gore otomatik belirle: {threshold}+ = onay
4. Kisa icerik = kotu demek degil. "Sessiz Luks" ozlu olmayi sever.

Simdi icerigi denetle ve JSON formatinda sonuc don.
"""
    return prompt.strip()


@tool
def stil_kilavuzu_yukle() -> str:
    """
    Style guide dosyalarini yukler (brand_colors, typography, style_config).

    The Perfectionist'in denetim sirasinda referans olarak kullandigi
    marka stil tanimlari.

    Returns:
        JSON formatinda birlestirilmis style guide
    """
    guide: dict = {}

    # Brand colors
    colors_path = STYLE_GUIDE_DIR / "brand_colors.json"
    if colors_path.exists():
        with open(colors_path, "r", encoding="utf-8") as f:
            guide["brand_colors"] = json.load(f)

    # Typography
    typography_path = STYLE_GUIDE_DIR / "typography.json"
    if typography_path.exists():
        with open(typography_path, "r", encoding="utf-8") as f:
            guide["typography"] = json.load(f)

    # Style config
    config_path = STYLE_GUIDE_DIR / "style_config.json"
    if config_path.exists():
        with open(config_path, "r", encoding="utf-8") as f:
            guide["style_config"] = json.load(f)

    if not guide:
        return json.dumps({
            "error": "Style guide dosyalari bulunamadi",
            "expected_path": str(STYLE_GUIDE_DIR),
            "expected_files": ["brand_colors.json", "typography.json", "style_config.json"]
        }, ensure_ascii=False, indent=2)

    return json.dumps(guide, ensure_ascii=False, indent=2)


@tool
def onaylanmis_ornekler_yukle(icerik_turu: Literal["metin", "gorsel_prompt", "fiyat_analizi", "trend_raporu", "recete"]) -> str:
    """
    Daha once onaylanmis ornek ciktilari yukler (benchmark icin).

    The Perfectionist bu ornekleri referans olarak kullanarak
    yeni iceriklerin kalitesini degerlendirir.

    Args:
        icerik_turu: Hangi tip icerik ornekleri (metin, gorsel_prompt, vs.)

    Returns:
        JSON formatinda onaylanmis ornek listesi
    """
    # Baslangic ornekleri - zamanla birikmeli
    approved_examples_db: dict[str, list[dict]] = {
        "metin": [
            {
                "ornek": "Beklenmedik. Cikolatanin rengini degistirmek icin boyaya ihtiyaci yoktur.",
                "puan": 95,
                "neden_iyi": "Kisa, gizemli, satis yapmayan, merak uyandiran",
                "kaynak": "narrator"
            },
            {
                "ornek": "Bazi tatlar anlatilmaz, sadece hissedilir.",
                "puan": 92,
                "neden_iyi": "Ozlu, sofistike, davet eden ton",
                "kaynak": "narrator"
            },
            {
                "ornek": "Fark edenler icin. %72 kakao, Ekvador mahsulu.",
                "puan": 88,
                "neden_iyi": "Hedef kitleyi tanimliyor, gosteris yok, bilgi ozlu",
                "kaynak": "narrator"
            }
        ],
        "gorsel_prompt": [
            {
                "ornek": "Create a premium product label for a quiet luxury chocolate brand. Minimalist design, ample white space, elegant serif typography. Color palette: dark chocolate brown (#3D2314), cream (#F5F0E8). No flashy elements.",
                "puan": 90,
                "neden_iyi": "Quiet luxury estetigi, teknik detaylar net, kacinilacaklar belirtilmis",
                "kaynak": "curator"
            }
        ],
        "fiyat_analizi": [
            {
                "ornek": "Vakko Chocolate 100g tablet: 280 TL. Sade pozisyonu: Premium segment, karsilastirma endeksi 0.95.",
                "puan": 85,
                "neden_iyi": "Nesnel ton, sayisal veriler net, yorum minimal",
                "kaynak": "pricing"
            }
        ],
        "trend_raporu": [],
        "recete": [
            {
                "ornek": "Tuz kristali aktivasyonu: Fleur de sel, %70 bitter uzerine son dakika serpistrisi. Termal sok yasak - oda sicakliginda birakinca tuz erir, tat dengesi bozulur.",
                "puan": 88,
                "neden_iyi": "Teknik dogru, pratik, 'yasak' acik belirtilmis",
                "kaynak": "alchemist"
            }
        ]
    }

    examples = approved_examples_db.get(icerik_turu, [])

    if not examples:
        return json.dumps({
            "icerik_turu": icerik_turu,
            "ornekler": [],
            "not": f"'{icerik_turu}' icin henuz onaylanmis ornek yok. Ilk onaylanan icerikler benchmark olarak eklenecek."
        }, ensure_ascii=False, indent=2)

    return json.dumps({
        "icerik_turu": icerik_turu,
        "ornek_sayisi": len(examples),
        "ornekler": examples
    }, ensure_ascii=False, indent=2)


__all__ = ["denetle", "stil_kilavuzu_yukle", "onaylanmis_ornekler_yukle"]
```

2. `src/sade_agents/skills/__init__.py` dosyasini guncelle - perfectionist skills'i ekle:

Mevcut dosyaya ekle:
```python
from sade_agents.skills.perfectionist_skills import denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle
```

Ve __all__ listesine ekle:
```python
"denetle",
"stil_kilavuzu_yukle",
"onaylanmis_ornekler_yukle",
```
  </action>
  <verify>
    python -c "from sade_agents.skills import denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle; print('denetle:', denetle.name); print('stil_kilavuzu_yukle:', stil_kilavuzu_yukle.name); print('onaylanmis_ornekler_yukle:', onaylanmis_ornekler_yukle.name)"
  </verify>
  <done>
    - denetle() skill LLM-as-Judge pattern'i ile calisir
    - stil_kilavuzu_yukle() mevcut style_guide/*.json dosyalarini okur
    - onaylanmis_ornekler_yukle() benchmark ornekleri dondurur
    - Tum skill'ler skills/__init__.py'den export edilir
  </done>
</task>

</tasks>

<verification>
```bash
# Model import kontrolu
python -c "from sade_agents.models import AuditResult, AUDIT_CRITERIA_BY_TYPE; print('Models OK')"

# Skills import kontrolu
python -c "from sade_agents.skills import denetle, stil_kilavuzu_yukle, onaylanmis_ornekler_yukle; print('Skills OK')"

# AuditResult serialize testi
python -c "
from sade_agents.models import AuditResult
r = AuditResult(
    content_type='metin',
    source_agent='narrator',
    overall_score=85,
    tone_score=90,
    vocabulary_score=80,
    structure_score=85,
    verdict='onay',
    issues=[],
    suggestions=[],
    summary_tr='Test basarili'
)
print(r.model_dump_json(indent=2))
"

# Skill fonksiyonalite testi
python -c "
from sade_agents.skills import stil_kilavuzu_yukle, onaylanmis_ornekler_yukle
import json

# Style guide yukle
guide = stil_kilavuzu_yukle.run()
data = json.loads(guide)
print('Style guide keys:', list(data.keys()) if 'error' not in data else 'ERROR')

# Ornekleri yukle
ornekler = onaylanmis_ornekler_yukle.run(icerik_turu='metin')
data = json.loads(ornekler)
print('Metin ornekleri:', data.get('ornek_sayisi', 0))
"
```
</verification>

<success_criteria>
- [ ] AuditResult Pydantic modeli olusturuldu ve JSON'a serialize edilebiliyor
- [ ] AUDIT_CRITERIA_BY_TYPE 5 agent tipi icin kriterler iceriyor
- [ ] denetle() skill yasak/tercih edilen ifadeleri iceren prompt donduruyor
- [ ] stil_kilavuzu_yukle() style_guide/*.json dosyalarini okuyor
- [ ] onaylanmis_ornekler_yukle() her icerik turu icin ornekler donduruyor
- [ ] Tum moduller dogru export ediliyor
</success_criteria>

<output>
After completion, create `.planning/phases/07-the-perfectionist/07-01-SUMMARY.md`
</output>
